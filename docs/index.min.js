var svgDragSelect=function(){"use strict"
function l(e,t,n){return t<=e&&e<=n}function L(e,t,n,r){return e.getEnclosureList?Array.prototype.slice.call(e.getEnclosureList(r,t)):a([],e,t||e,function(e){return function(e,t){var n=e.x,r=n+e.width,o=e.y,i=o+e.height
return l(t.x,n,r)&&l(t.x+t.width,n,r)&&l(t.y,o,i)&&l(t.y+t.height,o,i)}(n,e.getBBox())})}function C(e,t,n,r){return e.getIntersectionList?Array.prototype.slice.call(e.getIntersectionList(r,t)):a([],e,t||e,function(e){return function(e,t){var n=e.x,r=n+e.width,o=e.y,i=o+e.height
return(l(t.x,n,r)||l(t.x+t.width,n,r)||l(n,t.x,t.x+t.width))&&(l(t.y,o,i)||l(t.y+t.height,o,i)||l(o,t.y,t.y+t.height))}(n,e.getBBox())})}function x(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}function A(e,t,n,r,o){var i=e.createSVGRect()
return i.x=Math.min(t,r),i.y=Math.min(n,o),i.width=Math.abs(t-r),i.height=Math.abs(n-o),i}function b(e,t,n){if(!t)return n
var r=e.createSVGPoint()
r.x=n.x,r.y=n.y
var o=r.matrixTransform(t)
r.x+=n.width,r.y+=n.height
var i=r.matrixTransform(t)
return A(e,o.x,o.y,i.x,i.y)}var c=[SVGCircleElement,SVGEllipseElement,SVGImageElement,SVGLineElement,SVGPathElement,SVGPolygonElement,SVGPolylineElement,SVGRectElement,SVGTextElement,SVGUseElement],a=function(e,t,n,r){for(var o=n.firstElementChild;o;o=o.nextElementSibling)if(o instanceof SVGGElement)a(e,t,o,r)
else for(var i=0,l=c;i<l.length;i++){o instanceof l[i]&&r(o)&&e.push(o)}return e}
return function(v){function h(e){return A(t,n-document.documentElement.scrollLeft-document.body.scrollLeft,r-document.documentElement.scrollTop-document.body.scrollTop,e.clientX,e.clientY)}var m,n,r,E=[],t=v.svg,e=document.body.appendChild(document.createElement("div")),g=e.style
e.className="svg-drag-select-area-overlay",g.position="fixed",g.pointerEvents="none"
function o(e){var t=this
if((e.pointerId||0)===m){var n=h(e),r=b(this,this.getScreenCTM().inverse(),n),o=b(this,this.getCTM(),r),i=v.referenceElement||null,l=function(){return L(t,i,r,o)},c=function(){return C(t,i,r,o)},a="function"==typeof v.selector?v.selector({svg:this,referenceElement:i,pointerEvent:e,dragAreaInClientCoordinate:n,dragAreaInSvgCoordinate:r,dragAreaInInitialSvgCoordinate:o,getEnclosures:l,getIntersections:c}):"intersection"===v.selector?c():l(),s=x(a,E),u=x(E,a)
if(g.left=n.x+"px",g.top=n.y+"px",g.width=n.width+"px",g.height=n.height+"px",s.length||u.length){var d=E
E=a,v.onSelectionChange&&v.onSelectionChange({svg:this,referenceElement:i,pointerEvent:e,dragAreaInClientCoordinate:n,dragAreaInSvgCoordinate:r,dragAreaInInitialSvgCoordinate:o,selectedElements:E,previousSelectedElements:d,newlySelectedElements:s,newlyDeselectedElements:u})}}}function i(e){var t
!1!==e.isPrimary&&void 0===m&&(v.onSelectionStart&&v.onSelectionStart({svg:this,referenceElement:v.referenceElement||null,pointerEvent:e,cancel:function(){return t=1}}),t||(m=e.pointerId||0,n=e.clientX+document.documentElement.scrollLeft+document.body.scrollLeft,r=e.clientY+document.documentElement.scrollTop+document.body.scrollTop,E=[],o.call(this,e),g.display="",this.setPointerCapture&&this.setPointerCapture(m)))}function l(e){if((e.pointerId||0)===m){this.releasePointerCapture&&this.releasePointerCapture(m),m=void 0,g.display="none"
var t=h(e),n=b(this,this.getScreenCTM().inverse(),t),r=b(this,this.getCTM(),n)
v.onSelectionEnd&&v.onSelectionEnd({svg:this,referenceElement:v.referenceElement||null,pointerEvent:e,dragAreaInClientCoordinate:t,dragAreaInSvgCoordinate:n,dragAreaInInitialSvgCoordinate:r,selectedElements:E})}}var c,a=t.style.touchAction,s=getComputedStyle(t).touchAction
if("PointerEvent"in window){var u=t.getAttribute("draggable"),d=t.style.pointerEvents,f="none"!==s&&"pinch-zoom"!==s
f&&(t.style.touchAction="pinch-zoom"),t.style.pointerEvents="all",t.setAttribute("draggable","false"),t.addEventListener("pointerdown",i),t.addEventListener("pointermove",o),t.addEventListener("pointerup",l),t.addEventListener("pointercancel",l),c=function(){null===u?t.removeAttribute("draggable"):t.setAttribute("draggable",u),t.style.pointerEvents=d,f&&(t.style.touchAction=a),t.removeEventListener("pointerdown",i),t.removeEventListener("pointermove",o),t.removeEventListener("pointerup",l),t.removeEventListener("pointercancel",l),e.parentElement&&e.parentElement.removeChild(e)}}else if("ontouchend"in window){var p="manipulation"!==s
p&&(t.style.touchAction="manipulation")
var y=function(t,n){var r={pointerId:n.identifier}
return Object.keys(Object.getPrototypeOf(n)).forEach(function(e){return r[e]=n[e]}),Object.keys(Object.getPrototypeOf(t)).forEach(function(e){return r[e]=t[e]}),r},S=function(e){if(void 0!==m)for(var t=0;t<e.changedTouches.length;t++)e.changedTouches[t].identifier===m&&l.call(this,y(e,e.changedTouches[0]))}
t.addEventListener("touchstart",function(e){1===e.touches.length&&i.call(this,y(e,e.touches[0]))}),t.addEventListener("touchmove",function(e){1===e.touches.length&&(e.preventDefault(),o.call(this,y(e,e.touches[0])))}),t.addEventListener("touchend",S),t.addEventListener("touchcancel",S),c=function(){p&&(t.style.touchAction=a),t.removeEventListener("pointerdown",i),t.removeEventListener("pointermove",o),t.removeEventListener("pointerup",l),t.removeEventListener("pointercancel",l),e.parentElement&&e.parentElement.removeChild(e)}}else t.addEventListener("mousedown",i),t.addEventListener("mousemove",o),t.addEventListener("mouseup",l),c=function(){t.removeEventListener("mousedown",i),t.removeEventListener("mousemove",o),t.removeEventListener("mouseup",l),e.parentElement&&e.parentElement.removeChild(e)}
return{cancel:c,dragAreaOverlay:e}}}()
