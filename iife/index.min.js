var svgDragSelect=function(){"use strict"
function l(e,t,n){return t<=e&&e<=n}function S(e,t,i,n){return e.getEnclosureList?Array.prototype.slice.call(e.getEnclosureList(n,t)):s([],e,t||e,function(e){return t=i,n=e.getBBox(),r=t.x,o=r+t.width,e=t.y,t=e+t.height,l(n.x,r,o)&&l(n.x+n.width,r,o)&&l(n.y,e,t)&&l(n.y+n.height,e,t)
var t,n,r,o})}function L(e,t,i,n){return e.getIntersectionList?Array.prototype.slice.call(e.getIntersectionList(n,t)):s([],e,t||e,function(e){return t=i,n=e.getBBox(),r=t.x,o=r+t.width,e=t.y,t=e+t.height,(l(n.x,r,o)||l(n.x+n.width,r,o)||l(r,n.x,n.x+n.width))&&(l(n.y,e,t)||l(n.y+n.height,e,t)||l(e,n.y,n.y+n.height))
var t,n,r,o})}function C(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}function x(e,t,n,r,o){return(e=e.createSVGRect()).x=Math.min(t,r),e.y=Math.min(n,o),e.width=Math.abs(t-r),e.height=Math.abs(n-o),e}function A(e,t,n){if(!t)return n
var r=e.createSVGPoint()
r.x=n.x,r.y=n.y
var o=r.matrixTransform(t)
return r.x+=n.width,r.y+=n.height,t=r.matrixTransform(t),x(e,o.x,o.y,t.x,t.y)}var c=[SVGCircleElement,SVGEllipseElement,SVGImageElement,SVGLineElement,SVGPathElement,SVGPolygonElement,SVGPolylineElement,SVGRectElement,SVGTextElement,SVGUseElement],s=function(e,t,n,r){for(var o=n.firstElementChild;o;o=o.nextElementSibling)if(o instanceof SVGGElement)s(e,t,o,r)
else for(var i=0,l=c;i<l.length;i++)o instanceof l[i]&&r(o)&&e.push(o)
return e}
return function(d){function u(e){return x(t,n-document.documentElement.scrollLeft-document.body.scrollLeft,r-document.documentElement.scrollTop-document.body.scrollTop,e.clientX,e.clientY)}var h,n,r,m=[],t=d.svg,e=document.body.appendChild(document.createElement("div")),v=e.style
e.className="svg-drag-select-area-overlay",v.position="fixed",v.pointerEvents="none",v.display="none"
function o(e){var t,n,r,o,i,l,c,s,a=this;(e.pointerId||0)===h&&(t=u(e),n=A(this,this.getScreenCTM().inverse(),t),r=A(this,this.getCTM(),n),o=d.referenceElement||null,s=function(){return S(a,o,n,r)},c=function(){return L(a,o,n,r)},i="function"==typeof d.selector?d.selector({svg:this,referenceElement:o,pointerEvent:e,dragAreaInClientCoordinate:t,dragAreaInSvgCoordinate:n,dragAreaInInitialSvgCoordinate:r,getEnclosures:s,getIntersections:c}):("intersection"===d.selector?c:s)(),l=C(i,m),c=C(m,i),v.left=t.x+"px",v.top=t.y+"px",v.width=t.width+"px",v.height=t.height+"px",(l.length||c.length)&&(s=m,m=i,d.onSelectionChange&&d.onSelectionChange({svg:this,referenceElement:o,pointerEvent:e,dragAreaInClientCoordinate:t,dragAreaInSvgCoordinate:n,dragAreaInInitialSvgCoordinate:r,selectedElements:m,previousSelectedElements:s,newlySelectedElements:l,newlyDeselectedElements:c})))}function i(e){var t
!1!==e.isPrimary&&void 0===h&&(d.onSelectionStart&&d.onSelectionStart({svg:this,referenceElement:d.referenceElement||null,pointerEvent:e,cancel:function(){return t=1}}),t||(h=e.pointerId||0,n=e.clientX+document.documentElement.scrollLeft+document.body.scrollLeft,r=e.clientY+document.documentElement.scrollTop+document.body.scrollTop,m=[],o.call(this,e),v.display="",this.setPointerCapture&&this.setPointerCapture(h)))}function l(e){var t,n,r;(e.pointerId||0)===h&&(this.releasePointerCapture&&this.releasePointerCapture(h),h=void 0,v.display="none",t=u(e),n=A(this,this.getScreenCTM().inverse(),t),r=A(this,this.getCTM(),n),d.onSelectionEnd&&d.onSelectionEnd({svg:this,referenceElement:d.referenceElement||null,pointerEvent:e,dragAreaInClientCoordinate:t,dragAreaInSvgCoordinate:n,dragAreaInInitialSvgCoordinate:r,selectedElements:m}))}var c,s,a,E,g,p=t.style.touchAction,f=getComputedStyle(t).touchAction,y="PointerEvent"in window?(c=t.getAttribute("draggable"),s=t.style.pointerEvents,(a="none"!==f&&"pinch-zoom"!==f)&&(t.style.touchAction="pinch-zoom"),t.style.pointerEvents="all",t.setAttribute("draggable","false"),t.addEventListener("pointerdown",i),t.addEventListener("pointermove",o),t.addEventListener("pointerup",l),t.addEventListener("pointercancel",l),function(){null===c?t.removeAttribute("draggable"):t.setAttribute("draggable",c),t.style.pointerEvents=s,a&&(t.style.touchAction=p),t.removeEventListener("pointerdown",i),t.removeEventListener("pointermove",o),t.removeEventListener("pointerup",l),t.removeEventListener("pointercancel",l),e.parentElement&&e.parentElement.removeChild(e)}):"ontouchend"in window?((E="manipulation"!==f)&&(t.style.touchAction="manipulation"),g=function(t,n){var r={pointerId:n.identifier}
return Object.keys(Object.getPrototypeOf(n)).forEach(function(e){return r[e]=n[e]}),Object.keys(Object.getPrototypeOf(t)).forEach(function(e){return r[e]=t[e]}),r},y=function(e){if(void 0!==h)for(var t=0;t<e.changedTouches.length;t++)e.changedTouches[t].identifier===h&&l.call(this,g(e,e.changedTouches[0]))},t.addEventListener("touchstart",function(e){1===e.touches.length&&i.call(this,g(e,e.touches[0]))}),t.addEventListener("touchmove",function(e){1===e.touches.length&&(e.preventDefault(),o.call(this,g(e,e.touches[0])))}),t.addEventListener("touchend",y),t.addEventListener("touchcancel",y),function(){E&&(t.style.touchAction=p),t.removeEventListener("pointerdown",i),t.removeEventListener("pointermove",o),t.removeEventListener("pointerup",l),t.removeEventListener("pointercancel",l),e.parentElement&&e.parentElement.removeChild(e)}):(t.addEventListener("mousedown",i),t.addEventListener("mousemove",o),t.addEventListener("mouseup",l),function(){t.removeEventListener("mousedown",i),t.removeEventListener("mousemove",o),t.removeEventListener("mouseup",l),e.parentElement&&e.parentElement.removeChild(e)})
return{cancel:y,dragAreaOverlay:e}}}()
